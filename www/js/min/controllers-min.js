angular.module("starter.controllers",[]).controller("AppCtrl",function(t,e,o){t.loginData={},e.fromTemplateUrl("templates/login.html",{scope:t}).then(function(e){t.modal=e}),t.closeLogin=function(){t.modal.hide()},t.login=function(){t.modal.show()},t.doLogin=function(){console.log("Doing login",t.loginData),o(function(){t.closeLogin()},1e3)}}).controller("SettingsCtrl",function(t,e,o){t.logout=function(){var n=e.show({title:"Are you sure?",scope:t,buttons:[{text:"Logout",type:"button-assertive",onTap:function(t){localStorage.removeItem("the-hybrid_player"),o.go("app.the-hybrid")}},{text:"Cancel"}]})}}).controller("AJAXCtrl",function(t,e){t.doRefresh=function(){e.get("http://www.the-hybrid.co.uk/api.php?request=get_lore_posts").then(function(t){$("#lore_output").text(""),drawLore(t.data)},function(t){console.log("ERR",t)}),t.$broadcast("scroll.refreshComplete")},t.doRefresh()}).controller("HybridCtrl",function(t,e,o,n){}).controller("PlayerCtrl",function(t,e,o,n){t.playerRefresh=function(){t.getPlayerData(),t.$broadcast("scroll.refreshComplete")},t.getPlayerData=function(){var e=window.localStorage.getItem("the-hybrid_player");console.log(),t.loginPrompt=function(){var e=o.show({template:"Please Login to Access Player Data",title:"Choose your side",scope:t,buttons:[{text:"Login",type:"button-positive",onTap:function(t){n.go("app.login"),console.log("Login Pressed")}},{text:"Register",type:"button",onTap:function(t){return console.log("Register Pressed"),window.open("http://www.the-hybrid.co.uk","_system","location=yes"),!1}}]});e.then(function(t){})},null!=e?(e=JSON.parse(e),console.log(e),$("#player_id").text("Player ID: "+e.player.player_id),$("#player_xp").text("XP: "+e.player.xp.xp_general),$("#player_health").text("HP: "+e.player.health),$("#vampire_kills").text(e.player.xp.xp_vampire),$("#werewolf_kills").text(e.player.xp.xp_werewolf),$("#ghost_kills").text(e.player.xp.xp_ghost),$("#zombie_kills").text(e.player.xp.xp_zombie)):t.loginPrompt()},t.playerRefresh()}).controller("LoginCtrl",function(t,e,o){t.data={},t.showPopup=function(t,n){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var l=$("#password").val(),a=$("#username").val(),r=encodeURIComponent(l),i=encodeURIComponent(a);e({method:"POST",url:"http://www.the-hybrid.co.uk/api.php",data:$.param({request:"get_player_data",username:a,password:r}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t,e,n,l){console.log(l),console.warn(t);var a=JSON.stringify(t);window.localStorage.setItem("the-hybrid_player",a),o.go("app.player")})}}).controller("MapCtrl",function(t,e,o,n){var l;t.claim=function(){t.claimDialog()},t.claimDialog=function(){var n=e.show({template:'<p>The fate of humanity is in your hand</p><button ng-click="vampire()" ng-value="1" class="button button-block">Vampire</button"><button ng-click="werewolf()" class="button button-block">Werewolf</button><button class="button button-block" ng-click="ghost()">Ghost</button><button ng-click="zombie()" class="button button-block">Zombie</button>',title:"Choose your side",scope:t,buttons:[{text:"Cancel",type:"button-positive"}]});n.then(function(t){}),o(function(){n.close()},3e3)},t.showAlert=function(){var t=e.alert({title:"Infection Requires an Internet Connection",template:"It seems The Hybrid Companion cannot connect to the game servers. Please try again later.",animation:"fade-in"})},t.vampire=function(t){claim_location(1,l)},t.werewolf=function(t){claim_location(2,l)},t.ghost=function(t){claim_location(3,l)},t.zombie=function(t){claim_location(4,l)},t.sendUpdate=function(){claim.close(),n({method:"POST",url:"http://www.jamesrwilliams.co.uk/hybrid/api.php",data:$.param({request:"update_game",data:update_game}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t,e,o,n){})},o(function(){console.log("Rest")},6e3),n.get("http://www.jamesrwilliams.co.uk/hybrid/api.php?request=fetch_game").then(function(t){l=t.data,l=l.replace(/\\"/g,'"'),l=l.substring(1,l.length-1),l=JSON.parse(l),initialise(l)},function(e){t.showAlert()})});