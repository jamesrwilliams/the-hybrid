angular.module("starter.controllers",[]).controller("SettingsCtrl",function(e,t,o){e.logout=function(){var a=t.show({title:"Are you sure?",scope:e,buttons:[{text:"Logout",type:"button-assertive",onTap:function(e){localStorage.removeItem("the-hybrid_player"),o.go("app.the-hybrid")}},{text:"Cancel"}]})}}).controller("AJAXCtrl",function(e,t){e.doRefresh=function(){t.get("http://www.the-hybrid.co.uk/api.php?request=get_lore_posts").then(function(e){$("#lore_output").text(""),drawLore(e.data)},function(e){console.log("ERR",e)}),e.$broadcast("scroll.refreshComplete")},e.doRefresh()}).controller("PlayerCtrl",function(e,t,o,a){e.playerRefresh=function(){e.getPlayerData(),e.$broadcast("scroll.refreshComplete")},e.getPlayerData=function(){var t=window.localStorage.getItem("the-hybrid_player");e.loginPrompt=function(){var t=o.show({template:"Please Login to Access Player Data",title:"Choose your side",scope:e,buttons:[{text:"Login",type:"button-positive",onTap:function(e){a.go("app.login"),console.log("Login Pressed")}},{text:"Register",type:"button",onTap:function(e){return console.log("Register Pressed"),window.open("http://www.the-hybrid.co.uk","_system","location=yes"),!1}}]})},null!=t?(t=JSON.parse(t),console.log(t),$("#player_id").text("Player ID: "+t.player.player_id),$("#player_xp").text("XP: "+t.player.xp.xp_general),$("#player_health").text("HP: "+t.player.health),$("#vampire_kills").text(t.player.xp.xp_vampire),$("#werewolf_kills").text(t.player.xp.xp_werewolf),$("#ghost_kills").text(t.player.xp.xp_ghost),$("#zombie_kills").text(t.player.xp.xp_zombie)):e.loginPrompt()},e.playerRefresh()}).controller("LoginCtrl",function(e,t,o){e.data={},e.showPopup=function(e,a){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var n=$("#password").val(),l=$("#username").val(),r=encodeURIComponent(n),i=encodeURIComponent(l);t({method:"POST",url:"http://www.the-hybrid.co.uk/api.php",data:$.param({request:"get_player_data",username:l,password:r}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,t,a,n){console.log(n),console.warn(e);var l=JSON.stringify(e);window.localStorage.setItem("the-hybrid_player",l),o.go("app.player")})}}).controller("MapCtrl",function(e,t,o,a){e.claim=function(){e.claimDialog()},e.claimDialog=function(){var a=t.show({template:'<p>The fate of humanity is in your hand</p><button ng-click="vampire()" ng-value="1" class="button button-block">Vampire</button"><button ng-click="werewolf()" class="button button-block">Werewolf</button><button class="button button-block" ng-click="ghost()">Ghost</button><button ng-click="zombie()" class="button button-block">Zombie</button>',title:"Choose your side",scope:e,buttons:[{text:"Close",type:"button-positive"}]});o(function(){a.close()},6e3)},e.showAlert=function(){var e=t.alert({title:"Infection Requires an Internet Connection",template:"It seems The Hybrid Companion cannot connect to the game servers. Please try again later.",animation:"fade-in"})},e.vampire=function(e){claim_location(1,game)},e.werewolf=function(e){claim_location(2,game)},e.ghost=function(e){claim_location(3,game)},e.zombie=function(e){claim_location(4,game)},e.sendUpdate=function(){a({method:"POST",url:"http://www.jamesrwilliams.co.uk/hybrid/api.php",data:$.param({request:"update_game",data:update_game}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t,o,a,n){e.update()})},o(function(){e.update()},6e3),e.update=function(){a.get("http://www.jamesrwilliams.co.uk/hybrid/api.php?request=fetch_game").then(function(e){game=e.data,game=game.replace(/\\"/g,'"'),game=game.substring(1,game.length-1),'"'===game.charAt(0)&&game.charAt(game.length-1)?initialise(JSON.parse(game.substring(1,game.length-1))):initialise(JSON.parse(game))},function(t){e.showAlert()})},e.update()});